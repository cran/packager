<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Andreas Dominik Cullmann" />


<title>An Introduction to packager</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">An Introduction to <em>packager</em></h1>
<h4 class="author">Andreas Dominik Cullmann</h4>
<h4 class="date">2020-04-09, 15:43:44</h4>



<div id="teaser" class="section level1">
<h1>Teaser</h1>
<p><code>packager</code> is a set of functions I use to create and maintain most of my <code>R</code>-packages using a build process such as <a href="https://CRAN.R-project.org/package=fakemake"><code>fakemake</code></a> or, <a href="https://www.gnu.org/software/make/">GNU make</a>. It borrows heavily from packages <code>devtools</code>, <code>usethis</code>, <code>rcmdcheck</code>, <code>remotes</code> and <code>lintr</code>.</p>
</div>
<div id="withr" class="section level1">
<h1><code>withr</code></h1>
<p>Due to <a href="https://cran.r-project.org/web/packages/policies.html">the CRAN policy</a> of not writing “anywhere else on the file system apart from the R session’s temporary directory”, throughout this vignette I use <strong>R</strong>’s temporary directory, often by using <code>path &lt;- file.path(tempdir(), &quot;my_path&quot;)</code> followed by <code>withr::with_dir(path, ...)</code> or the like. I do this because this is a vignette and its codes are run on <a href="https://cran.r-project.org/">CRAN</a>.</p>
<p>In real life, we would skip the temporary directory stuff.</p>
</div>
<div id="creating-packages" class="section level1">
<h1>Creating Packages</h1>
<p>To create a new package I use:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">path &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;myFirstPackage&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">packager<span class="op">::</span><span class="kw">create</span>(path, <span class="dt">fakemake =</span> <span class="st">&quot;check&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in eval(parse(text = make_list[[index]][[&quot;code&quot;]])): 
## Spell check failed, see /tmp/Rtmpi0GjXM/myFirstPackage/log/spell.Rout for details.</code></pre>
<pre><code>## Warning: 'check_archive' is deprecated.
## Use 'packager::check_archive' instead.
## See help(&quot;Deprecated&quot;)</code></pre>
<p>The package is built, tested, checked and committed into git:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">list.files</span>(path, <span class="dt">recursive =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;DESCRIPTION&quot;                 &quot;LICENSE&quot;                    
##  [3] &quot;Makefile&quot;                    &quot;Meta&quot;                       
##  [5] &quot;NAMESPACE&quot;                   &quot;NEWS.md&quot;                    
##  [7] &quot;R&quot;                           &quot;README.Rmd&quot;                 
##  [9] &quot;TODO.md&quot;                     &quot;devel.R&quot;                    
## [11] &quot;doc&quot;                         &quot;inst&quot;                       
## [13] &quot;log&quot;                         &quot;make.R&quot;                     
## [15] &quot;man&quot;                         &quot;man-roxygen&quot;                
## [17] &quot;myFirstPackage.Rcheck&quot;       &quot;myFirstPackage_0.1.0.tar.gz&quot;
## [19] &quot;tests&quot;                       &quot;vignettes&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">r &lt;-<span class="st"> </span>git2r<span class="op">::</span><span class="kw">repository</span>(path)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">summary</span>(r)</a></code></pre></div>
<pre><code>## Local:    master /tmp/Rtmpi0GjXM/myFirstPackage
## Head:     [d9f8967] 2020-08-24: Packager Changes
## 
## Branches:         1
## Tags:             0
## Commits:         16
## Contributors:     1
## Stashes:          0
## Ignored files:    5
## Untracked files:  0
## Unstaged files:   0
## Staged files:     0
## 
## Latest commits:
## [d9f8967] 2020-08-24: Packager Changes
## [7f016e1] 2020-08-24: Adding `man-roxygen/return_invisibly_null.R` from template `return_invisibly_null.R` of package` packager`.
## [928fc22] 2020-08-24: Adding `make.R` from template `make.R` of package` packager`.
## [094f170] 2020-08-24: Adding `inst/runit_tests/runit-throw.R` from template `runit-throw.R` of package` packager`.
## [a5c7594] 2020-08-24: Adding `tests/runit.R` from template `runit.R` of package` packager`.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## working directory clean</code></pre>
<p>We can look at some of the files (the directory <code>myFirstPackage.Rcheck</code> might be of interest):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;spell.Rout&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## DESCRIPTION does not contain 'Language' field. Defaulting to 'en-US'.
##   WORD      FOUND IN
## RStudio   README.Rmd:8,9
## gitlab    README.Rmd:43</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">tail</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;check.Rout&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Status: 1 WARNING&quot;                                                   
## [2] &quot;See&quot;                                                                 
## [3] &quot;  ‘/tmp/Rtmpi0GjXM/myFirstPackage/myFirstPackage.Rcheck/00check.log’&quot;
## [4] &quot;for details.&quot;                                                        
## [5] &quot;&quot;                                                                    
## [6] &quot;&quot;</code></pre>
<p>And we see what`s left to do:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;TODO.md&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## - make sure https://gitlab.com/fvafrcu/myFirstPackage exists!</code></pre>
<div id="customizing" class="section level2">
<h2>Customizing</h2>
<p>We see that the package’s DESCRIPTION is filled with default values.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;DESCRIPTION&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## Package: myFirstPackage
## Title: What it Does (One Line, Title Case)
## Version: 0.1.0
## Authors@R:
##     person(given = &quot;Andreas Dominik&quot;,
##            family = &quot;Cullmann&quot;,
##            role = c(&quot;aut&quot;, &quot;cre&quot;),
##            email = &quot;fvafrcu@mailbox.org&quot;)
## Description: What the package does (one paragraph).
## License: BSD_2_clause + file LICENSE
## URL: https://gitlab.com/fvafrcu/myFirstPackage
## Depends:
##     R (&gt;= 4.1.0)
## Suggests: 
##     knitr,
##     rmarkdown,
##     pkgload,
##     testthat,
##     RUnit,
##     devtools,
##     rprojroot
## VignetteBuilder: 
##     knitr
## Encoding: UTF-8
## LazyData: true
## Roxygen: list(markdown = TRUE)
## RoxygenNote: 7.1.1</code></pre>
<p>We could set the package information on the existing package, but we rather create a new one now. So we get rid of our first package</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">unlink</span>(path, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="cf">if</span> (<span class="st">&quot;myFirstPackage&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">.packages</span>()) <span class="kw">detach</span>(<span class="st">&quot;package:myFirstPackage&quot;</span>, </a>
<a class="sourceLine" id="cb18-3" title="3">                                              <span class="dt">unload =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>and customize the package creation (but we skip the process of testing, building and checking for the sake of CPU time, we just build the docs):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">package_title &lt;-<span class="st"> &quot;veryImportantPackage&quot;</span></a>
<a class="sourceLine" id="cb19-2" title="2">path &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), package_title)</a>
<a class="sourceLine" id="cb19-3" title="3">a  &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">person</span>(<span class="dt">given =</span> <span class="st">&quot;Your&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;Name&quot;</span>, <span class="dt">email =</span> <span class="st">&quot;some@whe.re&quot;</span>, </a>
<a class="sourceLine" id="cb19-4" title="4">                    <span class="dt">role =</span> <span class="kw">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>))</a>
<a class="sourceLine" id="cb19-5" title="5">packager<span class="op">::</span><span class="kw">create</span>(path, <span class="dt">author_at_r =</span> a, <span class="dt">title =</span> package_title,</a>
<a class="sourceLine" id="cb19-6" title="6">                 <span class="dt">description =</span> <span class="st">&quot;This is very important.&quot;</span>,</a>
<a class="sourceLine" id="cb19-7" title="7">                 <span class="dt">details =</span> <span class="st">&quot;At least to me.&quot;</span>, <span class="dt">fakemake =</span> <span class="st">&quot;roxygen2&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;DESCRIPTION&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## Package: veryImportantPackage
## Title: veryImportantPackage
## Version: 0.1.0
## Authors@R:
##     person(given = &quot;Your&quot;,
##            family = &quot;Name&quot;,
##            role = c(&quot;aut&quot;, &quot;cre&quot;),
##            email = &quot;some@whe.re&quot;)
## Description: This is very important.
## License: BSD_2_clause + file LICENSE
## URL: https://gitlab.com/fvafrcu/veryImportantPackage
## Depends:
##     R (&gt;= 4.1.0)
## Suggests: 
##     knitr,
##     rmarkdown,
##     pkgload,
##     testthat,
##     RUnit,
##     devtools,
##     rprojroot
## VignetteBuilder: 
##     knitr
## Encoding: UTF-8
## LazyData: true
## Roxygen: list(markdown = TRUE)
## RoxygenNote: 7.1.1</code></pre>
<p>The package’s man page is set up accordingly:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">pkgload<span class="op">::</span><span class="kw">load_all</span>(path)</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">help</span>(<span class="kw">paste0</span>(package_title, <span class="st">&quot;-package&quot;</span>))</a></code></pre></div>
<pre><code>## Loading veryImportantPackage</code></pre>
<pre><code>## veryImportantPackage
## 
## Description:
## 
##      This is very important.
## 
## Details:
## 
##      You will find the details in
##      'vignette(&quot;An_Introduction_to_veryImportantPackage&quot;, package =
##      &quot;veryImportantPackage&quot;)'.</code></pre>
<p>I use</p>
<pre><code>adc &lt;- utils::person(given = &quot;Andreas Dominik&quot;,
                      family = &quot;Cullmann&quot;,
                      email = &quot;fvafrcu@mailbox.org&quot;,
                      role = c(&quot;aut&quot;, &quot;cre&quot;))
pop &lt;- as.list(getOption(&quot;packager&quot;))
pop[[&quot;whoami&quot;]] &lt;- adc
options(packager = pop)
</code></pre>
<p>in one of my startup files to set the author information globally.</p>
</div>
</div>
<div id="maintaining-packages-using-fakemake" class="section level1">
<h1>Maintaining Packages Using <a href="https://CRAN.R-project.org/package=fakemake"><code>fakemake</code></a></h1>
<p>Our brand new package veryImportantPackage is checked into git already:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">r &lt;-<span class="st"> </span>git2r<span class="op">::</span><span class="kw">repository</span>(path)</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="kw">summary</span>(r)</a></code></pre></div>
<pre><code>## Local:    master /tmp/Rtmpi0GjXM/veryImportantPackage
## Head:     [f565f6a] 2020-08-24: Packager Changes
## 
## Branches:         1
## Tags:             0
## Commits:         16
## Contributors:     1
## Stashes:          0
## Ignored files:    0
## Untracked files:  0
## Unstaged files:   0
## Staged files:     0
## 
## Latest commits:
## [f565f6a] 2020-08-24: Packager Changes
## [fa9eac9] 2020-08-24: Adding `man-roxygen/return_invisibly_null.R` from template `return_invisibly_null.R` of package` packager`.
## [1d1e2c4] 2020-08-24: Adding `make.R` from template `make.R` of package` packager`.
## [2c14d43] 2020-08-24: Adding `inst/runit_tests/runit-throw.R` from template `runit-throw.R` of package` packager`.
## [ab17183] 2020-08-24: Adding `tests/runit.R` from template `runit.R` of package` packager`.</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## working directory clean</code></pre>
<p>but we have so far only built the documentation from the <code>roxygen</code> comments:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">list.files</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;log&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;roxygen2.Rout&quot;</code></pre>
<p>So we get a <code>makelist</code> and look at its targets and aliases:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">ml &lt;-<span class="st"> </span>packager<span class="op">::</span><span class="kw">get_package_makelist</span>(<span class="dt">is_cran =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb32-2" title="2"><span class="kw">cbind</span>(<span class="kw">lapply</span>(ml, <span class="cf">function</span>(x) x[[<span class="st">&quot;target&quot;</span>]]),</a>
<a class="sourceLine" id="cb32-3" title="3">      <span class="kw">lapply</span>(ml, <span class="cf">function</span>(x) x[[<span class="st">&quot;alias&quot;</span>]]))</a></code></pre></div>
<pre><code>##       [,1]                                               [,2]           
##  [1,] &quot;log/roxygen2.Rout&quot;                                &quot;roxygen2&quot;     
##  [2,] &quot;log/spell.Rout&quot;                                   &quot;spell&quot;        
##  [3,] &quot;log/cleanr.Rout&quot;                                  &quot;cleanr&quot;       
##  [4,] &quot;log/lintr.Rout&quot;                                   &quot;lint&quot;         
##  [5,] &quot;log/covr.Rout&quot;                                    &quot;covr&quot;         
##  [6,] &quot;packager::get_pkg_archive_path(absolute = FALSE)&quot; &quot;build&quot;        
##  [7,] &quot;log/check.Rout&quot;                                   &quot;check&quot;        
##  [8,] &quot;.log.Rout&quot;                                        &quot;.log&quot;         
##  [9,] &quot;log/testthat.Rout&quot;                                &quot;testthat&quot;     
## [10,] &quot;log/vignettes.Rout&quot;                               &quot;vignettes&quot;    
## [11,] &quot;log/codetags.Rout&quot;                                &quot;codetags&quot;     
## [12,] &quot;log/news.Rout&quot;                                    &quot;news&quot;         
## [13,] &quot;log/usage.Rout&quot;                                   &quot;usage&quot;        
## [14,] &quot;log/winbuilder.Rout&quot;                              &quot;winbuilder&quot;   
## [15,] &quot;log/cran_comments.Rout&quot;                           &quot;cran_comments&quot;
## [16,] &quot;log/check_as_cran.Rout&quot;                           &quot;check_as_cran&quot;
## [17,] &quot;log/submit.Rout&quot;                                  &quot;submit&quot;</code></pre>
<div id="building-the-package" class="section level2">
<h2>Building the Package</h2>
<p>We choose to build the package:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">suppressMessages</span>(withr<span class="op">::</span><span class="kw">with_dir</span>(path, </a>
<a class="sourceLine" id="cb34-2" title="2">                                  <span class="kw">print</span>(fakemake<span class="op">::</span><span class="kw">make</span>(<span class="st">&quot;build&quot;</span>, ml, </a>
<a class="sourceLine" id="cb34-3" title="3">                                                       <span class="dt">verbose =</span> <span class="ot">FALSE</span>))))</a></code></pre></div>
<pre><code>## Warning in eval(parse(text = make_list[[index]][[&quot;code&quot;]])): 
## Spell check failed, see /tmp/Rtmpi0GjXM/veryImportantPackage/log/spell.Rout for details.</code></pre>
<pre><code>##  [1] &quot;log/cleanr.Rout&quot;                   &quot;log/codetags.Rout&quot;                
##  [3] &quot;log/covr.Rout&quot;                     &quot;log/lintr.Rout&quot;                   
##  [5] &quot;log/news.Rout&quot;                     &quot;log/spell.Rout&quot;                   
##  [7] &quot;log/testthat.Rout&quot;                 &quot;log/usage.Rout&quot;                   
##  [9] &quot;log/vignettes.Rout&quot;                &quot;veryImportantPackage_0.1.0.tar.gz&quot;</code></pre>
<p>We note the warning</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">cat</span>(git2r<span class="op">::</span><span class="kw">diff</span>(r, <span class="dt">as_char =</span> <span class="ot">TRUE</span>, <span class="dt">path =</span> <span class="kw">file.path</span>(<span class="st">&quot;.Rbuildignore&quot;</span>)))</a></code></pre></div>
<pre><code>## diff --git a/.Rbuildignore b/.Rbuildignore
## index 869d606..60acd7f 100644
## --- a/.Rbuildignore
## +++ b/.Rbuildignore
## @@ -15,3 +15,5 @@
##  ^man-roxygen/return_invisibly_null\.R$
##  ^\.log\.Rout$
##  ^log$
## +^doc$
## +^Meta$</code></pre>
<p>and see that now there are untracked files in our package’s log directory and that some files changed.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## Untracked files:
##  Untracked:  log/build.Rout
##  Untracked:  log/cleanr.Rout
##  Untracked:  log/codetags.Rout
##  Untracked:  log/covr.Rout
##  Untracked:  log/lintr.Rout
##  Untracked:  log/news.Rout
##  Untracked:  log/spell.Rout
##  Untracked:  log/testthat.Rout
##  Untracked:  log/usage.Rout
##  Untracked:  log/vignettes.Rout
## 
## Unstaged changes:
##  Modified:   .Rbuildignore
##  Modified:   .gitignore</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">cat</span>(<span class="kw">diff</span>(r, <span class="dt">as_char =</span> <span class="ot">TRUE</span>, <span class="dt">path =</span> <span class="st">&quot;.Rbuildignore&quot;</span>))</a></code></pre></div>
<pre><code>## diff --git a/.Rbuildignore b/.Rbuildignore
## index 869d606..60acd7f 100644
## --- a/.Rbuildignore
## +++ b/.Rbuildignore
## @@ -15,3 +15,5 @@
##  ^man-roxygen/return_invisibly_null\.R$
##  ^\.log\.Rout$
##  ^log$
## +^doc$
## +^Meta$</code></pre>
<p>After inspecting the change, we commit:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">withr<span class="op">::</span><span class="kw">with_dir</span>(path, packager<span class="op">::</span><span class="kw">git_add_commit</span>(<span class="dt">path =</span> <span class="st">&quot;.&quot;</span>, <span class="dt">untracked =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb43-2" title="2">                                               <span class="dt">message =</span> <span class="st">&quot;make build&quot;</span>))</a></code></pre></div>
<pre><code>## [38bdd6b] 2020-08-24: make build</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## working directory clean</code></pre>
</div>
<div id="checking-the-package" class="section level2">
<h2>Checking the Package</h2>
<p>So now we want the check the package:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">suppressMessages</span>(withr<span class="op">::</span><span class="kw">with_dir</span>(path, </a>
<a class="sourceLine" id="cb47-2" title="2">                                 <span class="kw">print</span>(fakemake<span class="op">::</span><span class="kw">make</span>(<span class="st">&quot;check&quot;</span>, ml, </a>
<a class="sourceLine" id="cb47-3" title="3">                                                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>))))</a></code></pre></div>
<pre><code>## Warning: 'check_archive' is deprecated.
## Use 'packager::check_archive' instead.
## See help(&quot;Deprecated&quot;)</code></pre>
<pre><code>## [1] &quot;log/cleanr.Rout&quot;                   &quot;log/covr.Rout&quot;                    
## [3] &quot;log/lintr.Rout&quot;                    &quot;log/testthat.Rout&quot;                
## [5] &quot;veryImportantPackage_0.1.0.tar.gz&quot; &quot;log/check.Rout&quot;</code></pre>
<p>We again see new files and changes to old files.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## Untracked files:
##  Untracked:  log/check.Rout
## 
## Unstaged changes:
##  Modified:   log/build.Rout</code></pre>
<p>Note that the <code>RUnit</code> test files are run while checking the tarball, hence we see output from <code>RUnit</code> in our log directory.</p>
<p>We assume that we passed the check:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">cat</span>(<span class="kw">tail</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;check.Rout&quot;</span>)), <span class="dt">n =</span> <span class="dv">7</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## 
## Status: 1 WARNING
## See
##   ‘/tmp/Rtmpi0GjXM/veryImportantPackage/veryImportantPackage.Rcheck/00check.log’
## for details.</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">check_log &lt;-<span class="st"> </span><span class="kw">file.path</span>(path, <span class="st">&quot;log&quot;</span>, <span class="st">&quot;check.Rout&quot;</span>)</a>
<a class="sourceLine" id="cb54-2" title="2">status &lt;-<span class="st"> </span>packager<span class="op">::</span><span class="kw">get_check_status</span>(check_log)</a>
<a class="sourceLine" id="cb54-3" title="3">RUnit<span class="op">::</span><span class="kw">checkEqualsNumeric</span>(status[[<span class="st">&quot;status&quot;</span>]][[<span class="st">&quot;errors&quot;</span>]], <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>and commit again</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">withr<span class="op">::</span><span class="kw">with_dir</span>(path, packager<span class="op">::</span><span class="kw">git_add_commit</span>(<span class="dt">path =</span> <span class="st">&quot;.&quot;</span>, <span class="dt">untracked =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb56-2" title="2">                                               <span class="dt">message =</span> <span class="st">&quot;make check&quot;</span>))</a></code></pre></div>
<pre><code>## [4bf2e58] 2020-08-24: make check</code></pre>
<p>If we choose to rerun the check without touching any files “down the make chain” (i.e. no files that any of our make targets depend on), we see there’s nothing to be done:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">system.time</span>(withr<span class="op">::</span><span class="kw">with_dir</span>(path, <span class="kw">print</span>(fakemake<span class="op">::</span><span class="kw">make</span>(<span class="st">&quot;check&quot;</span>, ml, <span class="dt">verbose =</span> <span class="ot">FALSE</span>))))</a></code></pre></div>
<pre><code>## NULL</code></pre>
<pre><code>##    user  system elapsed 
##   0.607   0.000   0.609</code></pre>
<p>This is the big difference between running the check via <code>fakemake</code> with a set of dependencies (set up with <code>packager</code>) and running the check (be it using <code>R CMD check</code> or <code>rcmdcheck::rcmdcheck</code> or its wrapper <code>devtools::check</code>) unconditionally: the latter method rebuilds and checks the whole package every time. <strong>This is why I wrote <code>packager</code> and <code>fakemake</code>.</strong></p>
</div>
<div id="submitting-the-package" class="section level2">
<h2>Submitting the Package</h2>
<p>Now we would like to submit our package to <a href="https://cran.r-project.org/">CRAN</a> (which we will not do here, but we want to!) We provide comments to <a href="https://cran.r-project.org/">CRAN</a>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">withr<span class="op">::</span><span class="kw">with_dir</span>(path, <span class="kw">print</span>(fakemake<span class="op">::</span><span class="kw">make</span>(<span class="st">&quot;cran_comments&quot;</span>, ml, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)))</a></code></pre></div>
<pre><code>## R CMD check results</code></pre>
<pre><code>## 0 errors | 1 warning  | 0 notes</code></pre>
<pre><code>## Warning in get_gitlab_info(path = path, private_token = private_token): You need
## a private token to access gitlab.</code></pre>
<pre><code>## [1] &quot;log/cran_comments.Rout&quot;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;cran-comments.md&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## Dear CRAN Team,
## this is a resubmission of package 'veryImportantPackage'. I have added the following changes:
## 
## * Added a `NEWS.md` file to track changes to the package.
## 
## 
## Please upload to CRAN.
## Best, Your
## 
## # Package veryImportantPackage 0.1.0
## 
## Reporting is done by packager version 1.4.0
## 
## ## Test  environments 
## - R Under development (unstable) (2020-06-12 r78687)
##     Platform: x86_64-pc-linux-gnu (64-bit)
##     Running under: Devuan GNU/Linux 3 (beowulf)
##     NA
## - win-builder (devel)
## 
## ## Local test results
## - Testthat:
##     OK: 1, Failed: 0, Warnings: 1, Skipped: 0
## - Coverage by covr:
##     
## 
## ## Local meta results
## - lintr:
##     found 1 lints in 32 lines of code (a ratio of 0.0312).
## - cleanr:
##     found 0 dreadful things about your code.
## - codetools::checkUsagePackage:
##     found 0 issues.
## - devtools::spell_check:
##     found 2 unkown words.</code></pre>
<p>After editing the contents we feel ready to submit:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">try</span>(packager<span class="op">::</span><span class="kw">submit</span>(path))</a></code></pre></div>
<pre><code>## Error in packager::submit(path) : You have uncommitted changes.</code></pre>
<p>Oops: we need to commit git first:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">packager<span class="op">::</span><span class="kw">git_add_commit</span>(<span class="dt">path =</span> path, <span class="dt">untracked =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb70-2" title="2">                         <span class="dt">message =</span> <span class="st">&quot;prepare for CRAN&quot;</span>)</a></code></pre></div>
<pre><code>## [9106bc2] 2020-08-24: prepare for CRAN</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">git2r<span class="op">::</span><span class="kw">status</span>(r)</a></code></pre></div>
<pre><code>## working directory clean</code></pre>
<p>Now we try and fail again, because this vignette is built in batch mode and there’s a security query which then fails:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1"><span class="kw">try</span>(packager<span class="op">::</span><span class="kw">submit</span>(path))</a></code></pre></div>
<pre><code>## Warning in packager::submit(path): You have no upstream!</code></pre>
<pre><code>## Ready to submit?Error in utils::menu(qs[rand]) : menu() cannot be used non-interactively</code></pre>
<p>Should you run this code interactively, you will be prompted for the security query (as you might be used from <code>devtools::release()</code>). Best you know <a href="https://cran.r-project.org/doc/manuals/R-exts.html">how to write R extensions</a> and <a href="https://cran.r-project.org/web/packages/policies.html">the CRAN policies</a>.</p>
<p>Anyway, we might want to tag the current commit and commence developing our package:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">packager<span class="op">::</span><span class="kw">git_tag</span>(<span class="dt">path =</span> path, <span class="dt">message =</span> <span class="st">&quot;A Tag&quot;</span>)</a></code></pre></div>
<pre><code>## [9106bc] 0.1.0</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">packager<span class="op">::</span><span class="kw">use_dev_version</span>(<span class="dt">path =</span> path)</a></code></pre></div>
<pre><code>## Package version bumped from '0.1.0' to '0.1.0.9000'</code></pre>
<pre><code>## [d7389dd] 2020-08-24: Using Developement Version</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">desc<span class="op">::</span><span class="kw">desc_get</span>(<span class="st">&quot;Version&quot;</span>, <span class="dt">file =</span> path)</a></code></pre></div>
<pre><code>##      Version 
## &quot;0.1.0.9000&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;NEWS.md&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## # veryImportantPackage 0.1.0.9000
## 
## * FIXME
## 
## # veryImportantPackage 0.1.0
## 
## * Added a `NEWS.md` file to track changes to the package.</code></pre>
<p>This is close to the workflow I have been using for most of my packages, substituting <a href="https://CRAN.R-project.org/package=fakemake"><code>fakemake</code></a> with <a href="https://www.gnu.org/software/make/">GNU make</a> whenever possible.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
